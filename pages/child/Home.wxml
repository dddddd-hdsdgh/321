<!-- pages/child/Home.wxml -->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="user-section">
    <view class="user-avatar">
      <view class="avatar-placeholder">{{userInfo ? userInfo.avatar : 'ğŸ‘¶'}}</view>
    </view>
    <view class="user-info">
      <text class="user-name">{{userInfo && userInfo.name ? userInfo.name : 'å°æœ‹å‹'}}</text>
      <text class="welcome-text">æ¬¢è¿æ¥åˆ°è¯­æ–‡åŠ¨ç”»å±‹ï¼</text>
    </view>
    <view class="badge">
      <text class="badge-text">{{userInfo && userInfo.grade ? userInfo.grade : 'ä¸€å¹´çº§'}}</text>
    </view>
  </view>

  <!-- ä»Šæ—¥æ¨èåŒºåŸŸ -->
  <view class="section">
    <view class="section-header">
      <view class="section-title-with-icon">
        <text class="section-icon">ğŸŒŸ</text>
        <text class="section-title">ä»Šæ—¥æ¨è</text>
      </view>
      <view class="section-more" bindtap="viewAllRecommend">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
        <text class="more-arrow">></text>
      </view>
    </view>
    
    <!-- åŠ è½½ä¸­çŠ¶æ€ -->
    <view class="loading-container" wx:if="{{isLoading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <!-- é”™è¯¯æç¤º -->
    <view class="error-container" wx:elif="{{error}}">
      <text class="error-text">{{error}}</text>
      <button class="retry-btn" bindtap="loadTodayRecommend">é‡æ–°åŠ è½½</button>
    </view>
    
    <!-- æ— æ•°æ®çŠ¶æ€ -->
    <view class="empty-container" wx:elif="{{todayRecommend.length === 0 && !isLoading}}">
      <image class="empty-image" src="/assets/icons/empty-courses.png" mode="aspectFit"></image>
      <text class="empty-text">æš‚æ— æ¨èè¯¾ç¨‹</text>
    </view>
    
    <!-- æ¨èè¯¾ç¨‹åˆ—è¡¨ -->
    <view class="recommend-list" wx:else>
      <view class="recommend-item" wx:for="{{todayRecommend}}" wx:key="id" data-id="{{item.id}}" data-type="{{item.type}}" bindtap="goToCourse">
        <image class="course-cover" wx:if="{{item.cover_image}}" src="{{item.cover_image}}" mode="aspectFill"></image>
        <view class="course-cover-placeholder" wx:else>{{item.difficulty === 'easy' ? 'â­' : item.difficulty === 'medium' ? 'â­â­' : 'â­â­â­'}}</view>
        <view class="course-info">
          <text class="course-title">{{item.title}}</text>
          <text class="course-description">{{item.description}}</text>
          <view class="course-meta">
            <text class="course-duration">{{item.total_duration}}åˆ†é’Ÿ</text>
            <view class="progress-bar">
              <view class="progress-bg"></view>
              <view class="progress-fill" style="width:{{item.progress}}%"></view>
            </view>
            <text class="progress-text">{{item.progress}}%</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½æ¨¡å—åŒºåŸŸ -->
  <view class="section">
    <view class="section-title-with-icon">
      <text class="section-icon">ğŸ®</text>
      <text class="section-title">å­¦ä¹ ä¹å›­</text>
    </view>
    <view class="feature-grid">
      <view class="feature-item" wx:for="{{functionModules}}" wx:key="id" data-id="{{item.id}}" bindtap="goToFeature">
        <view class="feature-icon">
          <image class="feature-icon-img" wx:if="{{item.icon}}" src="{{item.icon}}" mode="aspectFit"></image>
          <view class="icon-placeholder" wx:else>{{item.id === 'pinyin' ? 'ğŸ”¤' : item.id === 'hanzi' ? 'ğŸ“š' : item.id === 'sentence' ? 'ğŸ’¬' : 'ğŸ“'}}</view>
        </view>
        <text class="feature-title">{{item.name}}</text>
        <text class="feature-desc" wx:if="{{item.desc}}">{{item.desc}}</text>
      </view>
    </view>
  </view>

  <!-- æˆå°±å±•ç¤ºåŒºåŸŸ -->
  <view class="section">
    <view class="section-header">
      <view class="section-title-with-icon">
        <text class="section-icon">ğŸ†</text>
        <text class="section-title">æˆ‘çš„æˆå°±</text>
      </view>
      <view class="section-more" bindtap="goToAchievements">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
        <text class="more-arrow">></text>
      </view>
    </view>
    <view class="achievement-list">
      <view class="achievement-item" wx:for="{{achievements}}" wx:key="id" style="opacity:{{item.unlocked ? '1' : '0.5'}};filter:{{item.unlocked ? 'none' : 'grayscale(100%)'}};">
        <view class="achievement-icon">
          <image class="achievement-icon-img" wx:if="{{item.icon}}" src="{{item.icon}}" mode="aspectFit"></image>
          <view class="achievement-icon-placeholder" wx:else>{{item.unlocked ? 'ğŸ†' : 'ğŸ”’'}}</view>
        </view>
        <view class="achievement-info">
          <text class="achievement-title">{{item.name}}</text>
          <text class="achievement-desc">{{item.description}}</text>
          <text class="achievement-date" wx:if="{{item.unlocked_at}}">{{item.unlocked_at}}</text>
        </view>
        <view class="achievement-status">
          <text class="status-text">{{item.unlocked ? 'å·²è§£é”' : 'æœªè§£é”'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å­¦ä¹ æé†’ -->
  <view class="reminder">
    <text class="reminder-text">ğŸ“š å­¦ä¹ 20åˆ†é’Ÿåè®°å¾—ä¼‘æ¯ä¸€ä¸‹çœ¼ç›å“¦ï¼</text>
  </view>
</view>